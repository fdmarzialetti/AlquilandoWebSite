<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Employee Page</title>

    <link rel="stylesheet" href="../styles/admin.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />

    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        [v-cloak] {
            display: none;
        }

        .verify-box {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            text-align: center;
            width: 100%;
            max-width: 400px;
        }

        input[type="text"] {
            text-align: center;
            font-size: 1.2rem;
            letter-spacing: 4px;
        }

       
    </style>
</head>

<body id="app">
    <div class="d-flex justify-content-between align-items-center p-2"
         style="background-image: url('../images/backgroundHeader.jpg');">


        <a href="../index.html" class="d-flex align-items-center text-decoration-none">
            <img src="../images/AlquilandoLogo.png" alt="Alquilando" width="120" />
            <span class="fs-3 fw-bold text-dark ms-2">Alquilando</span>
        </a>
        <button class="btn btn-custom fw-bold dropdown-toggle boton-cuenta" type="button" id="dropdownCuenta"
                data-bs-toggle="dropdown" aria-expanded="false">
            Cuenta
        </button>
        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownCuenta">
            <li><a class="dropdown-item" href="#" @click="mostrarModalCambioClaveVoluntario(true)">Cambiar Contraseña</a></li>
            <li><a class="dropdown-item" href="#" @click="logout">Cerrar sesión</a></li>
        </ul>
    </div>

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark " style="font-family: sans-serif; width: 100%;">
        <div class="container-fluid">
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav mx-auto d-flex flex-row gap-4">
                    <li class="nav-item">
                        <a class="nav-link text-white" href="../pages/Employee.html">Grilla Reservas</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="../pages/listVehicles.html">Vehículos</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle text-white" href="#" data-bs-toggle="dropdown">
                            Acciones
                        </a>
                        <ul class="dropdown-menu dropdown-menu-dark">
                            <li><a class="dropdown-item" href="../pages/formClient.html">Registrar Cliente</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="bg-secondary py-3 border-bottom shadow-sm mb-4">
        <div class="container text-center">
            <h2 class="fw-semibold text-white m-0">Retiro y Devoluciones</h2>
        </div>
    </div>

    <main class="container py-4 d-flex flex-column gap-4" v-cloak>
        <div class="mb-4 d-flex justify-content-between">
            <div>
                <h3 class="border-bottom pb-2 mb-3"><i class="bi bi-list-task me-2"></i>Gestión de retiros y
                    devoluciones</h3>
                <div class="d-flex align-items-center gap-2">
                    <ul class="nav nav-pills justify-content-center d-flex gap-2" id="reservasTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="todas-tab" data-bs-toggle="pill"
                                data-bs-target="#todas-pane" type="button" role="tab">
                                <div class="d-flex gap-2">
                                    <span><i class="bi bi-card-list me-2"></i>Todas</span>
                                </div>
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="retiros-tab" data-bs-toggle="pill"
                                data-bs-target="#retiros-pane" type="button" role="tab">
                                <div class="d-flex gap-1">
                                    <span><i class="bi bi-box-arrow-in-right me-2"></i>Retiros</span>
                                    <span v-if="retirosPendientesHoy.length > 0" class="badge bg-warning ms-2">
                                        {{ retirosPendientesHoy.length }}
                                    </span>
                                </div>
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="devoluciones-tab" data-bs-toggle="pill"
                                data-bs-target="#devoluciones-pane" type="button" role="tab">
                                <div class="d-flex gap-2">
                                    <span><i class="bi bi-box-arrow-in-left me-2"></i>Devoluciones</span>
                                    <span v-if="devolucionesPendientesHoy.length > 0" class="badge bg-warning ms-2">{{
                                        devolucionesPendientesHoy.length }}</span>
                                </div>
                            </button>
                        </li>
                    </ul>
                </div>
            </div>

            <!--Filtro fechas-->
            <div>
                <h3 class="border-bottom pb-2 mb-3"><i class="bi bi-calendar-range me-2"></i>Reservas entre fechas</h3>
                <div class="d-flex align-items-center gap-1">
                    <label for="startDate" class="form-label mb-0">Inicio:</label>
                    <input type="date" id="startDate" v-model="startDate" :max="endDate" class="form-control"
                        style="max-width:180px;" />
                    <label for="endDate" class="form-label mb-0">Fin:</label>
                    <input type="date" id="endDate" v-model="endDate" :min="startDate" class="form-control"
                        style="max-width: 180px;" />
                    <button class="btn btn-outline-primary" @click="obtenerReservas">Actualizar</button>
                </div>
            </div>
        </div>

        <!-- PESTAÑAS -->
        <div class="tab-content">
            <!-- ================= TODAS ================ -->
            <div class="tab-pane fade show active" id="todas-pane" role="tabpanel">
                <div class="card shadow-sm mb-4">
                    <div class="card-header d-flex align-items-center justify-content-between">
                        <h5 class="mb-0 d-flex align-items-center gap-1">
                            <i class="bi bi-card-list me-2"></i>
                            <div class="dropdown">
                                <button class="btn dropdown-toggle"
                                    :class="['btn', 'dropdown-toggle', claseBadgeEstado(estadoSeleccionado)]"
                                    type="button" data-bs-toggle="dropdown" ref="dropdownBtn">
                                    <span v-if="estadoSeleccionado" class="badge bg-transparent text-white">
                                        {{ estadoSeleccionado }}
                                    </span>
                                    <span v-else class="">Todas</span>
                                </button>
                                <ul class="dropdown-menu">
                                    <li><button class="dropdown-item" @click="seleccionarEstado('')">Todas</button></li>
                                    <li>
                                        <button class="dropdown-item text-warning"
                                            @click="seleccionarEstado('Retiro Pendiente')">
                                            <span class="badge text-bg-warning">Retiro Pendiente</span>
                                        </button>
                                    </li>
                                    <li>
                                        <button class="dropdown-item text-warning"
                                            @click="seleccionarEstado('Devolución Pendiente')">
                                            <span class="badge text-bg-warning">Devolución Pendiente</span>
                                        </button>
                                    </li>
                                    <li>
                                        <button class="dropdown-item text-secondary"
                                            @click="seleccionarEstado('Retiro Próximo')">
                                            <span class="badge text-bg-secondary">Retiro Próximo</span>
                                        </button>
                                    </li>
                                    <li>
                                        <button class="dropdown-item text-secondary"
                                            @click="seleccionarEstado('Devolución Próxima')">
                                            <span class="badge text-bg-secondary">Devolución Próxima</span>
                                        </button>
                                    </li>
                                    <li>
                                        <button class="dropdown-item text-success"
                                            @click="seleccionarEstado('Reserva Finalizada')">
                                            <span class="badge text-bg-success">Reserva Finalizada</span>
                                        </button>
                                    </li>
                                    <li>
                                        <button class="dropdown-item text-danger"
                                            @click="seleccionarEstado('Reserva Cancelada')">
                                            <span class="badge text-bg-danger">Reserva Cancelada</span>
                                        </button>
                                    </li>
                                </ul>
                            </div>
                        </h5>
                        <div class="d-flex align-items-center gap-2">
                            <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#modalRetiro">
                                <i class="bi bi-check2-circle me-2"></i>Confirmar Retiro
                            </button>
                            <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#modalDevolucion">
                                <i class="bi bi-journal-check me-2"></i>Registrar Devolución
                            </button>
                        </div>
                    </div>


                    <div class="table-responsive overflow-auto" style="max-height: 32rem;">
                        <table class="table table-hover mb-0 text-center">
                            <thead class="table-light">
                                <tr>
                                    <th>Código</th>
                                    <th>Cliente</th>
                                    <th>Vehículo</th>
                                    <th>Fecha de retiro</th>
                                    <th>Fecha de devolución</th>
                                    <th>Estado</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="r in reservasFiltradas" :key="r.id">
                                    <td>{{ r.code }}</td>
                                    <td>{{ r.clientName || '—' }}</td>
                                    <td>{{ r.modelName }}</td>
                                    <td>{{ formatDate(r.startDate) }}</td>
                                    <td>{{ formatDate(r.endDate) }}</td>
                                    <td><span class="badge" :class="estadoGeneralClase(r)">{{ estadoGeneralReserva(r)
                                            }}</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- ================= RETIROS ================ -->
            <div class="tab-pane fade" id="retiros-pane" role="tabpanel">
                <div class="card shadow-sm mb-4">
                    <div class="card-header d-flex align-items-center justify-content-between">
                        <h5 class="mb-0 d-flex align-items-center gap-1">
                            <i class="bi bi-arrow-return-right me-2"></i> Retiros pendientes
                            <span class="badge bg-warning ms-2">{{ retirosPendientesHoy.length }}</span>
                        </h5>
                        <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#modalRetiro">
                            <i class="bi bi-check2-circle me-2"></i>Confirmar Retiro
                        </button>
                    </div>
                    <div class="table-responsive overflow-auto" style="max-height: 32rem;">
                        <table class="table table-hover mb-0 text-center">
                            <thead class="table-light">
                                <tr>
                                    <th>Código</th>
                                    <th>Cliente</th>
                                    <th>Vehículo</th>
                                    <th>Fecha de retiro</th>
                                    <th>Estado</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="r in pickups" :key="r.id">
                                    <td>{{ r.code }}</td>
                                    <td>{{ r.clientName || '—' }}</td>
                                    <td>{{ r.modelName }}</td>
                                    <td>{{ formatDate(r.startDate) }}</td>
                                    <td><span class="badge" :class="estadoClase(r)">{{ estadoTexto(r) }}</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- ============== DEVOLUCIONES ============== -->
            <div class="tab-pane fade" id="devoluciones-pane" role="tabpanel">
                <div class="card shadow-sm mb-4">
                    <div class="card-header d-flex align-items-center justify-content-between">
                        <h5 class="mb-0 d-flex align-items-center gap-1">
                            <i class="bi bi-arrow-return-left me-2"></i> Devoluciones pendientes
                            <span class="badge bg-warning ms-2">{{ devolucionesPendientesHoy.length }}</span>
                        </h5>
                        <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#modalDevolucion">
                            <i class="bi bi-journal-check me-2"></i>Registrar Devolución
                        </button>
                    </div>
                    <div class="table-responsive overflow-auto" style="max-height: 32rem;">
                        <table class="table table-hover mb-0 text-center">
                            <thead class="table-light">
                                <tr>
                                    <th>Código</th>
                                    <th>Cliente</th>
                                    <th>Vehículo</th>
                                    <th>Fecha de devolución</th>
                                    <th>Estado</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="r in returns" :key="r.id">
                                    <td>{{ r.code }}</td>
                                    <td>{{ r.clientName || '—' }}</td>
                                    <td>{{ r.modelName }}</td>
                                    <td>{{ formatDate(r.endDate) }}</td>
                                    <td><span class="badge" :class="claseEstadoDevolucion(r)">{{ estadoDevolucion(r)
                                            }}</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- MODALS -->
        <div class="modal fade" id="modalRetiro" tabindex="-1">
            <div class="modal-dialog modal-dialog-centered">
                <form class="modal-content" @submit.prevent>
                    <div class="modal-header">
                        <h5 class="modal-title">Confirmar Retiro</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body d-flex align-items-center justify-content-center">
                        <div class="verify-box w-100">
                            <h2>Ingrese el código de reserva</h2>
                            <input type="text" maxlength="6" class="form-control my-3" placeholder="Código de reserva"
                                v-model="codigoRetiro" />
                            <button class="btn btn-primary w-100" type="button" @click="verificarRetiro">Confirmar
                                Retiro</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <div class="modal fade" id="modalDevolucion" tabindex="-1">
            <div class="modal-dialog modal-dialog-centered">
                <form class="modal-content" @submit.prevent>
                    <div class="modal-header">
                        <h5 class="modal-title">Registrar Devolución</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body d-flex align-items-center justify-content-center">
                        <div class="verify-box w-100">
                            <h2>Ingrese el código de reserva</h2>
                            <input type="text" maxlength="6" class="form-control my-3" placeholder="Código de reserva"
                                v-model="codigoDevolucion" />
                            <label class="form-label mt-3">Comentario sobre la devolución (opcional):</label>
                            <textarea class="form-control" rows="3" placeholder="Escriba aquí algún comentario..."
                                v-model="comentarioDevolucion"></textarea>
                            <button class="btn btn-primary w-100 mt-3" type="button"
                                @click="registrarDevolucion">Registrar Devolución</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <script src="../scripts/employee.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>